<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ME 405 Term Project: ME 405 Term Project</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ME 405 Term Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">ME 405 Term Project </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_src_mainpage"></a> </p><dl class="section author"><dt>Author</dt><dd>Caleb Erlenborn </dd>
<dd>
Miles Alderman </dd></dl>
<dl class="section date"><dt>Date</dt><dd>March 20, 2023</dd></dl>
<h1><a class="anchor" id="autotoc_md0"></a>
Software Design</h1>
<p>The software architecture was designed around cooperative multitasking. Each subfunction was separated into its own task that voluntarily yields control of the processor to other tasks. Each task is written to cooperate with the others by regularly giving up control to ensure system performance and avoid blocking conditions. The tasks are managed by a scheduler, which functions by calling the task of the highest priority that is ready to run, as specified by the minimum period for it specified in its instantiation.</p>
<p>5 tasks were used in the codebase: one for each motor, one for the trigger servo, one for the thermal camera, and one for high level control of system operations and delegation to other tasks. This last task, "mastermind," handles all major logic and flow of operations of the blaster apparatus. The other 4 tasks represent no high-level logic, instead relying on flags/instructions such as set point to rotate to, whether or not it should fire, and whether or not to take an image. This approach was chosen to keep logic and system flow clear, simple, and centralized. It also minimized variables that needed to be shared between tasks, other than to mastermind. Inter-task data was handled with share variables, 6 of which were implemented to handle pitch/yaw angles of target as seen by camera, pitch/yaw angles to rotate to by motors, fire flag, and flag to take image.</p>
<p>In terms of duel sequencing, a 5 second timer was used after user button is pressed to wait until after the period in which each team may freely move behind their table. Due to the high latency of the thermal camera (1-2 Hz) we did not attempt to shoot while the target was moving. After this 5 seconds, the camera is queued to take an image, and after the motors are given to align with the new target, the trigger flag is raised to fire.</p>
<p>Within each motor task, 3 drivers classes are instiated for the encoder driver, motor driver, and position feedback control. The <a class="el" href="encoder__reader_8py.html" title="Encoder reader class.">encoder_reader.py</a> driver implements a class to read and manage the position of a quadrature encoder. It detects underflow/overflow conditions of the 16 bit counter and calculates the position delta. The <a class="el" href="motor__driver_8py.html" title="Motor driver class.">motor_driver.py</a> driver works by changing the direciton and duty cycle for a BDC motor based on a signed PWM duty cycle passed to it. The <a class="el" href="feedback__control_8py.html" title="Feedback Controller Class.">feedback_control.py</a> file implments a closed feedback controller to control position of the motor based on the aforementioned encoder and motor objects. It can use any combination of P/I/D control.</p>
<p>A task share diagram and finite state machines for each task can be referenced in the figures below.</p>
<h2><a class="anchor" id="autotoc_md1"></a>
Task Share Diagram</h2>
<p>The task share diagram describes the shared variables between tasks and priority/frequency of each task.</p>
<div class="image">
<img src="Task_Share.png" alt=""/>
<div class="caption">
Task Share Diagram</div></div>
    <h2><a class="anchor" id="autotoc_md2"></a>
Mastermind</h2>
<p>Mastermind handels all timing and processes information to define motor set points, request new camera image and set a trigger actuation. The finite state machine for mastermind is attached below.</p>
<div class="image">
<img src="Mastermind_FSM.png" alt=""/>
<div class="caption">
Mastermind FSM</div></div>
    <h2><a class="anchor" id="autotoc_md3"></a>
Thermal Camera</h2>
<p>The thermal camera state takes a picture by communicating with the mlx camera. This task also processes the image for a target and sets a desired yaw and pitch angle based on the camera field of view.</p>
<div class="image">
<img src="Thermal_Camera_FSM.png" alt=""/>
<div class="caption">
Thermal Camera FSM</div></div>
    <h2><a class="anchor" id="autotoc_md4"></a>
Trigger</h2>
<p>The trigger task is used to actuate a servo motor to fire the nerf gun when the signal from mastermind is recieved.</p>
<div class="image">
<img src="Trigger_FSM.png" alt=""/>
<div class="caption">
Trigger FSM</div></div>
    <h2><a class="anchor" id="autotoc_md5"></a>
Yaw and Pitch Motors FSM</h2>
<p>The finite machines for the yaw and pitch controller tasks are defined below. Both tasks use the same control approach and the desired set point is controlled by shared variables with mastermind.</p>
<p><img src="Yaw_FSM.png" alt="" class="inline" title="Yaw Motor FSM"/>     <img src="Pitch_FSM.png" alt="" class="inline" title="Pitch Motor FSM"/>     </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6 </li>
  </ul>
</div>
</body>
</html>
